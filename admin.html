<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="style.css"/>
<title>ANKA Admin Panel</title>

<style>
:root{
  --bg:#f5f7fa; --text:#1a202c; --muted:#718096;
  --brand-1:#f0b26f; --brand-2:#e2874a; --ring:#ffcf9b;
  --radius:16px; 
  --shadow:0 2px 8px rgba(0,0,0,.04), 0 1px 3px rgba(0,0,0,.08);
  --shadow-md:0 4px 12px rgba(0,0,0,.08), 0 2px 4px rgba(0,0,0,.06);
  --shadow-lg:0 12px 32px rgba(0,0,0,.12), 0 4px 8px rgba(0,0,0,.08);
  --danger:#ef4444; --success:#10b981;
  --border:#e2e8f0; --card-bg:#ffffff;
  --hover-bg:#f8fafc;
}

*{ box-sizing:border-box; scroll-behavior: smooth; }

body{
  margin:0; padding:0; font-family:'Poppins',system-ui,-apple-system,sans-serif; 
  color:var(--text); background: linear-gradient(135deg, #f5f7fa 0%, #e8edf3 100%);
  line-height:1.6; min-height:100vh;
}

.container{width:min(100% - 2rem, 1400px); margin-inline:auto; padding:0 1.5rem;}

/* Admin Header */
.admin-header{
  background: linear-gradient(135deg, #f0b26f 0%, #e2874a 50%, #d97744 100%);
  color:#fff; padding:3rem 0; margin-bottom:3rem;
  box-shadow: var(--shadow-lg);
  position:relative; overflow:hidden;
}

.admin-header::before{
  content:''; position:absolute; top:0; left:0; right:0; bottom:0;
  background:url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
  opacity:.3;
}

.admin-header .container{
  position:relative; z-index:1;
}

.admin-header h1{
  margin:0; font-size:2.75rem; font-weight:700; 
  display:flex; align-items:center; gap:1rem;
  text-shadow:0 2px 8px rgba(0,0,0,.1);
  letter-spacing:-0.5px;
}

.admin-header h1 i{
  font-size:2.5rem; opacity:.95;
  background:rgba(255,255,255,.15); padding:.75rem; border-radius:12px;
  backdrop-filter:blur(10px);
}

.admin-header p{
  margin:1rem 0 0; opacity:.95; font-size:1.15rem;
  font-weight:400; letter-spacing:0.2px;
}

.back-to-myanka{
  display:inline-flex; align-items:center; gap:.75rem;
  color:#fff; text-decoration:none; font-weight:600;
  font-size:.95rem; margin-bottom:1.5rem;
  padding:.75rem 1.5rem; background:rgba(255,255,255,.15);
  border-radius:10px; backdrop-filter:blur(10px);
  transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
  border:2px solid rgba(255,255,255,.2);
}

.back-to-myanka:hover{
  background:rgba(255,255,255,.25);
  transform:translateX(-4px);
  box-shadow:0 4px 12px rgba(0,0,0,.15);
  color: #1a202c;
}

.back-to-myanka i{
  font-size:1rem;
}

/* Tabs */
.admin-tabs{
  display:flex; gap:.75rem; margin-bottom:2.5rem; 
  background:var(--card-bg); padding:1rem;
  border-radius:var(--radius); box-shadow: var(--shadow-md);
  border:1px solid var(--border);
  overflow-x:auto;
}

.tab-btn{
  padding:1rem 2rem; border:none; background:transparent;
  font-size:1rem; font-weight:600; color:var(--muted);
  cursor:pointer; border-radius:10px;
  transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative; display:flex; align-items:center; gap:.75rem;
  white-space:nowrap;
  border:2px solid transparent;
}

.tab-btn:hover{ 
  color:var(--brand-2); 
  background:linear-gradient(135deg, rgba(240,178,111,.08) 0%, rgba(226,135,74,.08) 100%);
  transform:translateY(-2px);
}

.tab-btn.active{
  color:var(--brand-2); 
  background:linear-gradient(135deg, rgba(240,178,111,.15) 0%, rgba(226,135,74,.15) 100%);
  border-color:var(--brand-2);
  box-shadow:0 4px 12px rgba(226,135,74,.2);
}

.tab-btn.active::before{
  content:''; position:absolute; bottom:-1rem; left:50%; transform:translateX(-50%);
  width:40px; height:3px; background:var(--brand-2);
  border-radius:2px;
}

.tab-btn i{
  font-size:1.15rem;
}

/* Tab Content */
.tab-content{ 
  display:none; 
  animation:fadeIn .3s ease;
}

.tab-content.active{ display:block; }

@keyframes fadeIn{
  from{ opacity:0; transform:translateY(10px); }
  to{ opacity:1; transform:translateY(0); }
}

/* Forms */
.admin-form{
  background:var(--card-bg); padding:2.5rem; border-radius:var(--radius);
  box-shadow: var(--shadow-md); margin-bottom:2.5rem;
  border:1px solid var(--border);
  transition:all .3s ease;
}

.admin-form:hover{
  box-shadow: var(--shadow-lg);
  transform:translateY(-2px);
}

.admin-form h2{
  margin:0 0 2rem; font-size:1.875rem; color:var(--text);
  padding-bottom:1.25rem; border-bottom:3px solid var(--border);
  font-weight:700; letter-spacing:-0.3px;
  display:flex; align-items:center; gap:.75rem;
}

.admin-form h2::before{
  content:''; width:4px; height:24px; 
  background:linear-gradient(135deg, var(--brand-1), var(--brand-2));
  border-radius:2px;
}

.form-group{
  margin-bottom:1.75rem;
}

.form-group label{
  display:block; margin-bottom:.75rem; font-weight:600; color:var(--text);
  font-size:.95rem;
}

.form-group input,
.form-group textarea,
.form-group select{
  width:100%; padding:1rem 1.25rem; border:2px solid var(--border);
  border-radius:12px; font-size:1rem; font-family:inherit;
  transition:all .3s cubic-bezier(0.4, 0, 0.2, 1); 
  background:var(--card-bg);
  color:var(--text);
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus{
  outline:none; border-color:var(--brand-2);
  box-shadow:0 0 0 4px rgba(226,135,74,.12), var(--shadow-md);
  transform:translateY(-1px);
  background:#fff;
}

.form-group textarea{
  min-height:140px; resize:vertical; line-height:1.6;
}

.form-row{
  display:grid; grid-template-columns:1fr 1fr; gap:1.5rem;
}

@media (max-width:768px){
  .form-row{ grid-template-columns:1fr; }
  .admin-form{ padding:1.5rem; }
  .admin-tabs{ flex-wrap:wrap; padding:.25rem; }
  .tab-btn{ padding:.75rem 1.25rem; font-size:.9rem; }
}

#talent-pool{
  background-color: #f5f7fa;
}

#startups{
  background-color: #f5f7fa;
}

#news{
  background-color: #f5f7fa;
}

#users{
  background-color: #f5f7fa;
}

.form-group small{
  display:block; margin-top:.25rem; color:var(--muted);
  font-size:.85rem;
}

.form-group input[readonly]{
  background:#f8f9fa; cursor:not-allowed;
  opacity:.8;
  transition: color 0.3s ease;
}

.form-group input[readonly].username-available{
  color:#22c55e !important;
}

.form-group input[readonly].username-taken{
  color:#f59e0b !important;
}

.btn{
  padding:1rem 2.25rem; border:none; border-radius:12px;
  font-size:1rem; font-weight:600; cursor:pointer;
  transition:all .3s cubic-bezier(0.4, 0, 0.2, 1); 
  display:inline-flex; align-items:center;
  gap:.75rem; box-shadow: var(--shadow-md);
  position:relative; overflow:hidden;
}

.btn::before{
  content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
  transition:left .5s ease;
}

.btn:hover::before{
  left:100%;
}

.btn-primary{
  background: linear-gradient(135deg, var(--brand-1) 0%, var(--brand-2) 100%);
  color:#fff; border:2px solid transparent;
}

.btn-primary:hover{
  transform:translateY(-3px); 
  box-shadow:0 8px 24px rgba(226,135,74,.4), 0 4px 8px rgba(226,135,74,.2);
}

.btn-primary:active{
  transform:translateY(-1px);
}

.btn-danger{
  background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color:#fff; border:2px solid transparent;
}

.btn-danger:hover{
  background:linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  transform:translateY(-3px);
  box-shadow:0 8px 24px rgba(239,68,68,.4), 0 4px 8px rgba(239,68,68,.2);
}

.btn-small{
  padding:.5rem 1rem; font-size:.875rem;
}

/* Lists */
.items-list{
  background:var(--card-bg); border-radius:var(--radius);
  box-shadow: var(--shadow-md); overflow:hidden;
  border:1px solid var(--border);
}

.items-list h2{
  margin:0; padding:2rem; 
  background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border-bottom:2px solid var(--border); font-size:1.625rem;
  color:var(--text); font-weight:700;
  display:flex; align-items:center; gap:.75rem;
}

.item-card{
  padding:2rem; border-bottom:1px solid var(--border);
  display:flex; justify-content:space-between; align-items:start;
  gap:2rem; transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative;
}

.item-card::before{
  content:''; position:absolute; left:0; top:0; bottom:0; width:4px;
  background:transparent; transition:all .3s ease;
}

.item-card:hover{
  background:var(--hover-bg);
  transform:translateX(4px);
  box-shadow:0 4px 12px rgba(0,0,0,.06);
}

.item-card:hover::before{
  background:linear-gradient(135deg, var(--brand-1), var(--brand-2));
}

.item-card:last-child{ border-bottom:none; }

.item-info{ flex:1; }
.item-info h3{
  margin:0 0 .75rem; font-size:1.35rem; color:var(--text);
  font-weight:600;
}
.item-info p{
  margin:.5rem 0; color:var(--muted); font-size:.95rem;
  line-height:1.6;
}

.item-info p strong{
  color:var(--text); font-weight:600;
}

.item-actions{
  display:flex; gap:.75rem; flex-wrap:wrap; align-items:flex-start;
}

.applicants-btn{
  background:var(--brand-1); color:#fff;
  box-shadow: var(--shadow);
}

.applicants-btn:hover{
  background:var(--brand-2); transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(240,178,111,.4);
}

/* Modal */
.modal{
  display:none; position:fixed; inset:0; z-index:1000;
  background:rgba(0,0,0,.6); backdrop-filter:blur(6px);
  align-items:center; justify-content:center; padding:1rem;
  animation:fadeIn .2s ease;
}

.modal.active{ display:flex; }

.modal-content{
  background:var(--card-bg); border-radius:var(--radius); padding:2.5rem;
  max-width:750px; width:100%; max-height:85vh; overflow-y:auto;
  box-shadow:0 32px 64px rgba(0,0,0,.3), 0 8px 16px rgba(0,0,0,.2);
  animation:slideUp .4s cubic-bezier(0.4, 0, 0.2, 1);
  border:1px solid var(--border);
  position:relative;
}

.modal-content::before{
  content:''; position:absolute; top:0; left:0; right:0; height:4px;
  background:linear-gradient(90deg, var(--brand-1), var(--brand-2));
  border-radius:var(--radius) var(--radius) 0 0;
}

@keyframes slideUp{
  from{ transform:translateY(20px); opacity:0; }
  to{ transform:translateY(0); opacity:1; }
}

.modal-header{
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:2rem; padding-bottom:1rem; border-bottom:2px solid var(--border);
}

.modal-header h2{
  margin:0; font-size:1.75rem; color:var(--text);
}

.modal-close{
  background:none; border:none; font-size:2rem;
  cursor:pointer; color:var(--muted); line-height:1;
  width:36px; height:36px; display:flex; align-items:center;
  justify-content:center; border-radius:50%; transition:all .2s ease;
}

.modal-close:hover{ 
  color:var(--text); background:#f8f9fa;
}

.applicants-list{
  list-style:none; padding:0; margin:0;
}

.applicant-item{
  padding:1.5rem; background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border-radius:12px; margin-bottom:1rem; 
  border:2px solid var(--border);
  transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative;
  overflow:hidden;
}

.applicant-item::before{
  content:''; position:absolute; left:0; top:0; bottom:0; width:4px;
  background:transparent; transition:all .3s ease;
}

.applicant-item:hover{
  background:var(--card-bg); box-shadow: var(--shadow-md);
  transform:translateX(6px) translateY(-2px);
  border-color:var(--brand-2);
}

.applicant-item:hover::before{
  background:linear-gradient(135deg, var(--brand-1), var(--brand-2));
}

.applicant-item strong{
  display:block; margin-bottom:.5rem; color:var(--text);
  font-size:1.1rem;
}

.applicant-item p{
  margin:.25rem 0; color:var(--muted); font-size:.9rem;
}

.applicant-item a{
  color:var(--brand-2); text-decoration:none; font-weight:500;
  transition:color .2s ease;
}

.applicant-item a:hover{ 
  color:var(--brand-1); text-decoration:underline;
}

.empty-state{
  text-align:center; padding:4rem 2rem; color:var(--muted);
}

.empty-state i{
  font-size:4rem; margin-bottom:1.5rem; opacity:.3;
  color:var(--muted);
}

.empty-state p{
  font-size:1.1rem; margin:0;
}

.alert{
  padding:1.25rem 1.75rem; border-radius:12px; margin-bottom:1.5rem;
  display:flex; align-items:center; gap:1rem; font-weight:500;
  box-shadow: var(--shadow-md);
  border-left:4px solid;
  animation:slideIn .3s ease;
}

@keyframes slideIn{
  from{ transform:translateX(-20px); opacity:0; }
  to{ transform:translateX(0); opacity:1; }
}

.alert-success{
  background:#d4edda; color:#155724; border:1px solid #c3e6cb;
}

.alert-error{
  background:#f8d7da; color:#721c24; border:1px solid #f5c6cb;
}

.alert i{
  font-size:1.25rem;
}

#alertContainer{
  position:sticky; top:1rem; z-index:100; margin-bottom:1rem;
}
</style>
</head>
<body>

<div class="admin-header">
  <div class="container">
    <a href="loggedIn.html" class="back-to-myanka">
      <i class="fas fa-arrow-left"></i> MyANKA'ya Geri Dön
    </a>
    <h1><i class="fas fa-shield-alt"></i> ANKA Admin Panel</h1>
    <p>Manage Talent Pool, Startup Hub, and News</p>
  </div>
</div>

<div class="container">
  <div id="alertContainer"></div>

  <div class="admin-tabs">
    <button class="tab-btn active" data-tab="talent-pool">
      <i class="fas fa-briefcase"></i> Talent Pool
    </button>
    <button class="tab-btn" data-tab="startups">
      <i class="fas fa-rocket"></i> Startup Hub
    </button>
    <button class="tab-btn" data-tab="news">
      <i class="fas fa-newspaper"></i> News
    </button>
    <button class="tab-btn" data-tab="users">
      <i class="fas fa-user-plus"></i> Add Member
    </button>
  </div>

  <!-- Talent Pool Tab -->
  <div id="talent-pool" class="tab-content active">
    <div class="admin-form">
      <h2>Add New Job Posting</h2>
      <form id="addJobForm">
        <div class="form-row">
          <div class="form-group">
            <label>Company Name *</label>
            <input type="text" name="name" required>
          </div>
          <div class="form-group">
            <label>Industry *</label>
            <input type="text" name="industry" required>
          </div>
        </div>
        <div class="form-group">
          <label>Short Description *</label>
          <textarea name="description_short" required></textarea>
        </div>
        <div class="form-group">
          <label>Long Description</label>
          <textarea name="description_long"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Headquarters</label>
            <input type="text" name="headquarters">
          </div>
          <div class="form-group">
            <label>Website</label>
            <input type="url" name="website">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Job Type</label>
            <select name="jobtype">
              <option value="">Select...</option>
              <option value="full-time">Full-time</option>
              <option value="part-time">Part-time</option>
            </select>
          </div>
          <div class="form-group">
            <label>Experience Level</label>
            <select name="experience">
              <option value="">Select...</option>
              <option value="internship">Internship</option>
              <option value="junior">Junior / Entry</option>
              <option value="mid">Mid Level</option>
              <option value="senior">Senior</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add Job Posting
        </button>
      </form>
    </div>

    <div class="items-list">
      <h2 style="padding:1.5rem; margin:0; border-bottom:2px solid rgba(0,0,0,.1);">Current Job Postings</h2>
      <div id="jobsList">
        <div class="empty-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Startups Tab -->
  <div id="startups" class="tab-content">
    <div class="admin-form">
      <h2>Add New Startup</h2>
      <form id="addStartupForm">
        <div class="form-row">
          <div class="form-group">
            <label>Startup Name *</label>
            <input type="text" name="name" required>
          </div>
          <div class="form-group">
            <label>Industry</label>
            <input type="text" name="industry">
          </div>
        </div>
        <div class="form-group">
          <label>Description *</label>
          <textarea name="description" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Website</label>
            <input type="text" name="website" placeholder="https://example.com">
          </div>
          <div class="form-group">
            <label>Logo URL</label>
            <input type="text" name="logoUrl" placeholder="https://example.com/logo.png">
          </div>
        </div>
        <div class="form-group">
          <label>Detail Page URL</label>
          <input type="text" name="detailPageUrl" placeholder="e.g., Online_Startup_Companies/startup-name.html">
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add Startup
        </button>
      </form>
    </div>

    <div class="items-list">
      <h2 style="padding:1.5rem; margin:0; border-bottom:2px solid rgba(0,0,0,.1);">Current Startups</h2>
      <div id="startupsList">
        <div class="empty-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- News Tab -->
  <div id="news" class="tab-content">
    <div class="admin-form">
      <h2>Add New News</h2>
      <form id="addNewsForm">
        <div class="form-group">
          <label>Title *</label>
          <input type="text" name="title" required>
        </div>
        <div class="form-group">
          <label>Description *</label>
          <textarea name="description" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Image URL *</label>
            <input type="url" name="imageUrl" required>
          </div>
          <div class="form-group">
            <label>Date *</label>
            <input type="text" name="date" placeholder="e.g., Feb 26, 2025" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add News
        </button>
      </form>
    </div>

    <div class="items-list">
      <h2 style="padding:1.5rem; margin:0; border-bottom:2px solid rgba(0,0,0,.1);">Current News</h2>
      <div id="newsList">
        <div class="empty-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Tab -->
  <div id="users" class="tab-content">
    <div class="admin-form">
      <h2>Add New Member</h2>
      <form id="addUserForm">
        <div class="form-row">
          <div class="form-group">
            <label>Name *</label>
            <input type="text" name="name" id="userName" required>
          </div>
          <div class="form-group">
            <label>Surname *</label>
            <input type="text" name="surname" id="userSurname" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Username *</label>
            <input type="text" name="username" id="userUsername" required readonly>
            <small style="color:var(--muted); font-size:.85rem;">Auto-generated from name.surname</small>
          </div>
          <div class="form-group">
            <label>Password *</label>
            <input type="password" name="password" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input type="email" name="email">
          </div>
          <div class="form-group">
            <label>Gender</label>
            <select name="gender">
              <option value="">Select...</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
              <option value="Prefer not to say">Prefer not to say</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Major</label>
            <input type="text" name="major">
          </div>
          <div class="form-group">
            <label>University</label>
            <input type="text" name="uni">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Year of Birth</label>
            <input type="text" name="yob" placeholder="e.g., 2000">
          </div>
          <div class="form-group">
            <label>CV Link</label>
            <input type="url" name="cvLink" placeholder="https://...">
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="isAdmin" value="true" style="width:auto; margin-right:.5rem;">
            Admin User
          </label>
          <small style="display:block; color:var(--muted); font-size:.85rem; margin-top:.25rem;">
            Check this box to make this user an admin
          </small>
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-user-plus"></i> Add Member
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Applicants Modal -->
<div id="applicantsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalCompanyName">Applicants</h2>
      <button class="modal-close">&times;</button>
    </div>
    <div id="applicantsContent">
      <div class="empty-state">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading...</p>
      </div>
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://anka-vkrl.onrender.com';
const username = sessionStorage.getItem('username');
const isAdminValue = sessionStorage.getItem('isAdmin');
const isAdmin = isAdminValue === 'true';

// Debug logs
console.log('Admin check - username:', username);
console.log('Admin check - isAdmin from storage:', isAdminValue, 'Type:', typeof isAdminValue);
console.log('Admin check - isAdmin boolean:', isAdmin);

// Check admin status
if (!isAdmin) {
  console.error('Admin access denied. isAdmin value:', isAdminValue);
  alert('Admin access required. Redirecting to login...');
  window.location.href = 'login.html';
}

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const tabId = btn.dataset.tab;
    console.log('Tab clicked:', tabId);
    
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    
    const tabElement = document.getElementById(tabId);
    console.log('Tab element found:', tabElement, 'ID:', tabId);
    
    if (tabElement) {
      tabElement.classList.add('active');
      console.log('Tab activated:', tabId, 'Has active class:', tabElement.classList.contains('active'));
    } else {
      console.error('Tab element not found:', tabId);
      console.log('Available tab contents:', Array.from(document.querySelectorAll('.tab-content')).map(el => el.id));
    }
    
    // Reload data when switching tabs
    if (tabId === 'talent-pool') loadJobs();
    else if (tabId === 'startups') loadStartups();
    else if (tabId === 'news') loadNews();
  });
});

// Show alert
function showAlert(message, type = 'success') {
  const alertContainer = document.getElementById('alertContainer');
  const alert = document.createElement('div');
  alert.className = `alert alert-${type}`;
  alert.textContent = message;
  alertContainer.innerHTML = '';
  alertContainer.appendChild(alert);
  setTimeout(() => alert.remove(), 5000);
}

// Load Jobs
async function loadJobs() {
  try {
    const res = await fetch(`${API_BASE}/api/companies`);
    const jobs = await res.json();
    const container = document.getElementById('jobsList');
    
    if (jobs.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-briefcase"></i><p>No job postings yet</p></div>';
      return;
    }
    
      container.innerHTML = jobs.map((job, index) => `
      <div class="item-card">
        <div class="item-info">
          <h3>${(job.name || '').replace(/'/g, '&#39;').replace(/"/g, '&quot;')}</h3>
          <p><strong>Industry:</strong> ${job.industry || 'N/A'}</p>
          <p><strong>Location:</strong> ${job.headquarters || 'N/A'}</p>
          <p><strong>Job Type:</strong> ${job.jobtype || 'N/A'} | <strong>Experience:</strong> ${job.experience || 'N/A'}</p>
          <p>${job.description_short || ''}</p>
          <p><strong>Applicants:</strong> ${(job.applicants || []).length}</p>
        </div>
        <div class="item-actions">
          <button class="btn btn-small applicants-btn" data-company-name="${(job.name || '').replace(/"/g, '&quot;')}" data-action="view-applicants">
            <i class="fas fa-users"></i> View Applicants
          </button>
          <button class="btn btn-small btn-danger" data-job-id="${job._id}" data-job-name="${(job.name || '').replace(/"/g, '&quot;')}" data-action="delete-job">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('');
    
    // Attach event listeners for jobs
    container.querySelectorAll('[data-action="delete-job"]').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-job-id');
        const name = this.getAttribute('data-job-name');
        console.log('Delete job clicked:', id, name);
        deleteJob(id, name);
      });
    });
    
    container.querySelectorAll('[data-action="view-applicants"]').forEach(btn => {
      btn.addEventListener('click', () => {
        const companyName = btn.getAttribute('data-company-name');
        viewApplicants(companyName);
      });
    });
  } catch (err) {
    console.error('Failed to load jobs:', err);
    document.getElementById('jobsList').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load jobs</p></div>';
  }
}

// Add Job
document.getElementById('addJobForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  data.username = username;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/companies`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('Job posting added successfully!', 'success');
      e.target.reset();
      loadJobs();
    } else {
      showAlert(result.message || 'Failed to add job posting', 'error');
    }
  } catch (err) {
    showAlert('Error adding job posting', 'error');
  }
});

// Delete Job
async function deleteJob(id, name) {
  console.log('deleteJob called with:', id, name);
  if (!id) {
    console.error('No ID provided for deletion');
    showAlert('Error: No ID provided', 'error');
    return;
  }
  
  if (!confirm(`Are you sure you want to delete "${name}"?`)) return;
  
  try {
    console.log('Deleting job:', `${API_BASE}/api/admin/companies/${id}?username=${username}`);
    const res = await fetch(`${API_BASE}/api/admin/companies/${id}?username=${username}`, {
      method: 'DELETE'
    });
    
    let result;
    try {
      result = await res.json();
    } catch (jsonErr) {
      console.error('Failed to parse response:', jsonErr);
      const text = await res.text();
      console.error('Response text:', text);
      showAlert(`Server error (${res.status}): ${text || 'Unknown error'}`, 'error');
      return;
    }
    
    console.log('Delete response status:', res.status);
    console.log('Delete response:', result);
    
    if (res.ok) {
      showAlert('Job posting deleted successfully!', 'success');
      loadJobs();
    } else {
      const errorMsg = result.error ? `${result.message}: ${result.error}` : (result.message || `Server error ${res.status}`);
      console.error('Delete failed:', errorMsg, result);
      showAlert(errorMsg || 'Failed to delete job posting', 'error');
    }
  } catch (err) {
    console.error('Delete error:', err);
    showAlert('Error deleting job posting: ' + err.message, 'error');
  }
}

// View Applicants
async function viewApplicants(companyName) {
  const modal = document.getElementById('applicantsModal');
  const content = document.getElementById('applicantsContent');
  const title = document.getElementById('modalCompanyName');
  
  title.textContent = `Applicants for ${companyName}`;
  content.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Loading...</p></div>';
  modal.classList.add('active');
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/companies/${encodeURIComponent(companyName)}/applicants?username=${username}`);
    const data = await res.json();
    
    if (data.applicants.length === 0) {
      content.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>No applicants yet</p></div>';
    } else {
      content.innerHTML = `
        <ul class="applicants-list">
          ${data.applicants.map(applicant => `
            <li class="applicant-item">
              <strong>${applicant.name} ${applicant.surname}</strong>
              <p>Username: ${applicant.username}</p>
              ${applicant.cvLink ? `<p><a href="${applicant.cvLink}" target="_blank">View CV</a></p>` : ''}
            </li>
          `).join('')}
        </ul>
      `;
    }
  } catch (err) {
    content.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load applicants</p></div>';
  }
}

// Load Startups
async function loadStartups() {
  try {
    const res = await fetch(`${API_BASE}/api/startups`);
    const startups = await res.json();
    const container = document.getElementById('startupsList');
    
    if (startups.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-rocket"></i><p>No startups yet</p></div>';
      return;
    }
    
    container.innerHTML = startups.map(startup => `
      <div class="item-card">
        <div class="item-info">
          <h3>${(startup.name || '').replace(/"/g, '&quot;')}</h3>
          <p><strong>Industry:</strong> ${startup.industry || 'N/A'}</p>
          <p>${startup.description || ''}</p>
          ${startup.website ? `<p><a href="${startup.website}" target="_blank">${startup.website}</a></p>` : ''}
        </div>
        <div class="item-actions">
          <button class="btn btn-small btn-danger" data-startup-id="${startup._id}" data-startup-name="${(startup.name || '').replace(/"/g, '&quot;')}" data-action="delete-startup">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('');
    
    // Attach delete event listeners for startups
    container.querySelectorAll('[data-action="delete-startup"]').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-startup-id');
        const name = this.getAttribute('data-startup-name');
        console.log('Delete startup clicked:', id, name);
        deleteStartup(id, name);
      });
    });
    
    // Attach delete event listeners
    container.querySelectorAll('[data-action="delete-startup"]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-startup-id');
        const name = btn.getAttribute('data-startup-name');
        deleteStartup(id, name);
      });
    });
  } catch (err) {
    console.error('Failed to load startups:', err);
    document.getElementById('startupsList').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load startups</p></div>';
  }
}

// Add Startup
document.getElementById('addStartupForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  data.username = username;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/startups`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('Startup added successfully!', 'success');
      e.target.reset();
      loadStartups();
    } else {
      showAlert(result.message || 'Failed to add startup', 'error');
    }
  } catch (err) {
    showAlert('Error adding startup', 'error');
  }
});

// Delete Startup
async function deleteStartup(id, name) {
  console.log('deleteStartup called with:', id, name);
  if (!id) {
    console.error('No ID provided for deletion');
    showAlert('Error: No ID provided', 'error');
    return;
  }
  
  if (!confirm(`Are you sure you want to delete "${name}"?`)) return;
  
  try {
    console.log('Deleting startup:', `${API_BASE}/api/admin/startups/${id}?username=${username}`);
    const res = await fetch(`${API_BASE}/api/admin/startups/${id}?username=${username}`, {
      method: 'DELETE'
    });
    
    let result;
    try {
      result = await res.json();
    } catch (jsonErr) {
      console.error('Failed to parse response:', jsonErr);
      const text = await res.text();
      console.error('Response text:', text);
      showAlert(`Server error (${res.status}): ${text || 'Unknown error'}`, 'error');
      return;
    }
    
    console.log('Delete response status:', res.status);
    console.log('Delete response:', result);
    
    if (res.ok) {
      showAlert('Startup deleted successfully!', 'success');
      loadStartups();
    } else {
      const errorMsg = result.error ? `${result.message}: ${result.error}` : (result.message || `Server error ${res.status}`);
      console.error('Delete failed:', errorMsg, result);
      showAlert(errorMsg || 'Failed to delete startup', 'error');
    }
  } catch (err) {
    console.error('Delete error:', err);
    showAlert('Error deleting startup: ' + err.message, 'error');
  }
}

// Load News
async function loadNews() {
  try {
    const res = await fetch(`${API_BASE}/api/news`);
    const news = await res.json();
    const container = document.getElementById('newsList');
    
    if (news.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-newspaper"></i><p>No news yet</p></div>';
      return;
    }
    
      container.innerHTML = news.map(item => `
      <div class="item-card">
        <div class="item-info">
          <h3>${(item.title || '').replace(/"/g, '&quot;')}</h3>
          <p><strong>Date:</strong> ${item.date || ''}</p>
          <p>${(item.description || '').substring(0, 150)}${(item.description || '').length > 150 ? '...' : ''}</p>
          ${item.imageUrl ? `<p><a href="${item.imageUrl}" target="_blank">View Image</a></p>` : ''}
        </div>
        <div class="item-actions">
          <button class="btn btn-small btn-danger" data-news-id="${item._id}" data-news-title="${(item.title || '').replace(/"/g, '&quot;')}" data-action="delete-news">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('');
    
    // Attach delete event listeners for news
    container.querySelectorAll('[data-action="delete-news"]').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-news-id');
        const title = this.getAttribute('data-news-title');
        console.log('Delete news clicked:', id, title);
        deleteNews(id, title);
      });
    });
  } catch (err) {
    console.error('Failed to load news:', err);
    document.getElementById('newsList').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load news</p></div>';
  }
}

// Add News
document.getElementById('addNewsForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  data.username = username;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/news`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('News added successfully!', 'success');
      e.target.reset();
      loadNews();
    } else {
      showAlert(result.message || 'Failed to add news', 'error');
    }
  } catch (err) {
    showAlert('Error adding news', 'error');
  }
});

// Delete News
async function deleteNews(id, title) {
  console.log('deleteNews called with:', id, title);
  if (!id) {
    console.error('No ID provided for deletion');
    showAlert('Error: No ID provided', 'error');
    return;
  }
  
  if (!confirm(`Are you sure you want to delete "${title}"?`)) return;
  
  try {
    console.log('Deleting news:', `${API_BASE}/api/admin/news/${id}?username=${username}`);
    const res = await fetch(`${API_BASE}/api/admin/news/${id}?username=${username}`, {
      method: 'DELETE'
    });
    
    let result;
    try {
      result = await res.json();
    } catch (jsonErr) {
      console.error('Failed to parse response:', jsonErr);
      const text = await res.text();
      console.error('Response text:', text);
      showAlert(`Server error (${res.status}): ${text || 'Unknown error'}`, 'error');
      return;
    }
    
    console.log('Delete response status:', res.status);
    console.log('Delete response:', result);
    
    if (res.ok) {
      showAlert('News deleted successfully!', 'success');
      loadNews();
    } else {
      const errorMsg = result.error ? `${result.message}: ${result.error}` : (result.message || `Server error ${res.status}`);
      console.error('Delete failed:', errorMsg, result);
      showAlert(errorMsg || 'Failed to delete news', 'error');
    }
  } catch (err) {
    console.error('Delete error:', err);
    showAlert('Error deleting news: ' + err.message, 'error');
  }
}

// Add User
document.getElementById('addUserForm')?.addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = {};
  
  // Get all form values
  for (const [key, value] of formData.entries()) {
    if (key === 'isAdmin') {
      data.isAdmin = value === 'true' ? true : undefined;
    } else if (value.trim() !== '') {
      data[key] = value.trim();
    }
  }
  
  // Add admin username for authentication (this is the admin's username, not the new user's)
  data.adminUsername = username;
  
  // The new user's username is in data.username (from the form)
  console.log('Adding user with data:', { ...data, password: '***' });
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/users`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    let result;
    try {
      result = await res.json();
    } catch (jsonErr) {
      const text = await res.text();
      showAlert(`Server error (${res.status}): ${text || 'Unknown error'}`, 'error');
      return;
    }
    
    if (res.ok) {
      showAlert('Member added successfully!', 'success');
      e.target.reset();
      const usernameInput = document.getElementById('userUsername');
      if (usernameInput) usernameInput.value = '';
    } else {
      const errorMsg = result.error ? `${result.message}: ${result.error}` : (result.message || `Server error ${res.status}`);
      showAlert(errorMsg || 'Failed to add member', 'error');
    }
  } catch (err) {
    console.error('Error adding user:', err);
    showAlert('Error adding member: ' + err.message, 'error');
  }
});

// Auto-generate username from name.surname with availability check
let usernameCheckTimeout;
document.getElementById('userName')?.addEventListener('input', updateUsername);
document.getElementById('userSurname')?.addEventListener('input', updateUsername);

async function updateUsername() {
  const name = document.getElementById('userName')?.value.trim() || '';
  const surname = document.getElementById('userSurname')?.value.trim() || '';
  const usernameInput = document.getElementById('userUsername');
  
  if (!usernameInput || !name || !surname) {
    if (usernameInput) usernameInput.value = '';
    return;
  }
  
  // Clear previous timeout
  clearTimeout(usernameCheckTimeout);
  
  // Generate base username
  const baseUsername = `${name}.${surname}`.toLowerCase()
    .replace(/ğ/g, 'g').replace(/ü/g, 'u').replace(/ş/g, 's')
    .replace(/ı/g, 'i').replace(/ö/g, 'o').replace(/ç/g, 'c')
    .replace(/[^a-z0-9.]/g, '');
  
  // Show base username immediately
  usernameInput.value = baseUsername;
  usernameInput.classList.remove('username-available', 'username-taken');
  usernameInput.style.color = '#666';
  
  // Debounce: Wait 500ms after user stops typing before checking availability
  usernameCheckTimeout = setTimeout(async () => {
    try {
      const res = await fetch(`${API_BASE}/api/admin/users/check-username?baseUsername=${encodeURIComponent(baseUsername)}`);
      const result = await res.json();
      
      if (res.ok && result.username) {
        usernameInput.value = result.username;
        
        // Change color and class based on availability
        usernameInput.classList.remove('username-available', 'username-taken');
        if (result.available) {
          usernameInput.classList.add('username-available');
          usernameInput.style.color = '#22c55e'; // Green for available
        } else {
          usernameInput.classList.add('username-taken');
          usernameInput.style.color = '#f59e0b'; // Orange for auto-incremented
        }
      } else {
        usernameInput.classList.remove('username-available', 'username-taken');
        usernameInput.style.color = '#666';
      }
    } catch (err) {
      console.error('Error checking username availability:', err);
      usernameInput.classList.remove('username-available', 'username-taken');
      usernameInput.style.color = '#666';
    }
  }, 500);
}


// Modal close
document.querySelector('.modal-close').addEventListener('click', () => {
  document.getElementById('applicantsModal').classList.remove('active');
});

document.getElementById('applicantsModal').addEventListener('click', (e) => {
  if (e.target.id === 'applicantsModal') {
    document.getElementById('applicantsModal').classList.remove('active');
  }
});

// Debug: Check all tab contents on load
console.log('Available tab contents on load:', Array.from(document.querySelectorAll('.tab-content')).map(el => ({ id: el.id, classes: el.className })));
console.log('Users tab element:', document.getElementById('users'));

// Initial load
loadJobs();
</script>
</body>
</html>

