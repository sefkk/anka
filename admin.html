<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="style.css"/>
<title>ANKA Admin Panel</title>

<style>
:root{
  --bg:#ffffff; --text:#222; --muted:#6b6b6b;
  --brand-1:#f0b26f; --brand-2:#e2874a; --ring:#ffcf9b;
  --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.08);
  --danger:#e74c3c; --success:#2ecc71;
}

*{ box-sizing:border-box; scroll-behavior: smooth; }

body{
  margin:0; padding:0; font-family:'Poppins',system-ui,Arial,sans-serif; 
  color:var(--text); background: var(--bg);
}

.container{width:min(100% - 2rem, 1200px); margin-inline:auto}

/* Admin Header */
.admin-header{
  background: linear-gradient(135deg, var(--brand-1) 0%, var(--brand-2) 100%);
  color:#fff; padding:2rem 0; margin-bottom:2rem;
  box-shadow: var(--shadow);
}

.admin-header h1{
  margin:0; font-size:2rem; font-weight:700;
}

.admin-header p{
  margin:.5rem 0 0; opacity:.9;
}

/* Tabs */
.admin-tabs{
  display:flex; gap:.5rem; margin-bottom:2rem; border-bottom:2px solid rgba(0,0,0,.1);
  flex-wrap:wrap;
}

.tab-btn{
  padding:.75rem 1.5rem; border:none; background:transparent;
  font-size:1rem; font-weight:600; color:var(--muted);
  cursor:pointer; border-bottom:3px solid transparent;
  transition:all .3s ease;
}

.tab-btn:hover{ color:var(--brand-2); }
.tab-btn.active{
  color:var(--brand-2); border-bottom-color:var(--brand-2);
}

/* Tab Content */
.tab-content{ display:none; }
.tab-content.active{ display:block; }

/* Forms */
.admin-form{
  background:#fff; padding:2rem; border-radius:var(--radius);
  box-shadow: var(--shadow); margin-bottom:2rem;
}

.form-group{
  margin-bottom:1.5rem;
}

.form-group label{
  display:block; margin-bottom:.5rem; font-weight:600; color:var(--text);
}

.form-group input,
.form-group textarea,
.form-group select{
  width:100%; padding:.75rem; border:2px solid rgba(0,0,0,.1);
  border-radius:8px; font-size:1rem; font-family:inherit;
  transition:border-color .3s ease;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus{
  outline:none; border-color:var(--brand-2);
}

.form-group textarea{
  min-height:120px; resize:vertical;
}

.form-row{
  display:grid; grid-template-columns:1fr 1fr; gap:1rem;
}

@media (max-width:768px){
  .form-row{ grid-template-columns:1fr; }
}

.btn{
  padding:.75rem 1.5rem; border:none; border-radius:8px;
  font-size:1rem; font-weight:600; cursor:pointer;
  transition:all .3s ease;
}

.btn-primary{
  background: linear-gradient(135deg, var(--brand-1) 0%, var(--brand-2) 100%);
  color:#fff;
}

.btn-primary:hover{
  transform:translateY(-2px); box-shadow:0 4px 12px rgba(226,135,74,.3);
}

.btn-danger{
  background:var(--danger); color:#fff;
}

.btn-danger:hover{
  background:#c0392b; transform:translateY(-2px);
}

.btn-small{
  padding:.4rem .8rem; font-size:.875rem;
}

/* Lists */
.items-list{
  background:#fff; border-radius:var(--radius);
  box-shadow: var(--shadow); overflow:hidden;
}

.item-card{
  padding:1.5rem; border-bottom:1px solid rgba(0,0,0,.1);
  display:flex; justify-content:space-between; align-items:start;
  gap:1rem;
}

.item-card:last-child{ border-bottom:none; }

.item-info{ flex:1; }
.item-info h3{
  margin:0 0 .5rem; font-size:1.2rem; color:var(--text);
}
.item-info p{
  margin:.25rem 0; color:var(--muted); font-size:.9rem;
}

.item-actions{
  display:flex; gap:.5rem; flex-wrap:wrap;
}

.applicants-btn{
  background:var(--brand-1); color:#fff;
}

.applicants-btn:hover{
  background:var(--brand-2);
}

/* Modal */
.modal{
  display:none; position:fixed; inset:0; z-index:1000;
  background:rgba(0,0,0,.5); backdrop-filter:blur(4px);
  align-items:center; justify-content:center; padding:1rem;
}

.modal.active{ display:flex; }

.modal-content{
  background:#fff; border-radius:var(--radius); padding:2rem;
  max-width:600px; width:100%; max-height:80vh; overflow-y:auto;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
}

.modal-header{
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:1.5rem;
}

.modal-header h2{
  margin:0; font-size:1.5rem;
}

.modal-close{
  background:none; border:none; font-size:2rem;
  cursor:pointer; color:var(--muted); line-height:1;
}

.modal-close:hover{ color:var(--text); }

.applicants-list{
  list-style:none; padding:0; margin:0;
}

.applicant-item{
  padding:1rem; background:#f9f9f9; border-radius:8px;
  margin-bottom:.5rem;
}

.applicant-item strong{
  display:block; margin-bottom:.25rem; color:var(--text);
}

.applicant-item a{
  color:var(--brand-2); text-decoration:none;
}

.applicant-item a:hover{ text-decoration:underline; }

.empty-state{
  text-align:center; padding:3rem; color:var(--muted);
}

.empty-state i{
  font-size:3rem; margin-bottom:1rem; opacity:.5;
}

.alert{
  padding:1rem; border-radius:8px; margin-bottom:1rem;
}

.alert-success{
  background:#d4edda; color:#155724; border:1px solid #c3e6cb;
}

.alert-error{
  background:#f8d7da; color:#721c24; border:1px solid #f5c6cb;
}
</style>
</head>
<body>

<div class="admin-header">
  <div class="container">
    <h1><i class="fas fa-shield-alt"></i> ANKA Admin Panel</h1>
    <p>Manage Talent Pool, Startup Hub, and News</p>
  </div>
</div>

<div class="container">
  <div id="alertContainer"></div>

  <div class="admin-tabs">
    <button class="tab-btn active" data-tab="talent-pool">
      <i class="fas fa-briefcase"></i> Talent Pool
    </button>
    <button class="tab-btn" data-tab="startups">
      <i class="fas fa-rocket"></i> Startup Hub
    </button>
    <button class="tab-btn" data-tab="news">
      <i class="fas fa-newspaper"></i> News
    </button>
  </div>

  <!-- Talent Pool Tab -->
  <div id="talent-pool" class="tab-content active">
    <div class="admin-form">
      <h2>Add New Job Posting</h2>
      <form id="addJobForm">
        <div class="form-row">
          <div class="form-group">
            <label>Company Name *</label>
            <input type="text" name="name" required>
          </div>
          <div class="form-group">
            <label>Industry *</label>
            <input type="text" name="industry" required>
          </div>
        </div>
        <div class="form-group">
          <label>Short Description *</label>
          <textarea name="description_short" required></textarea>
        </div>
        <div class="form-group">
          <label>Long Description</label>
          <textarea name="description_long"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Headquarters</label>
            <input type="text" name="headquarters">
          </div>
          <div class="form-group">
            <label>Website</label>
            <input type="url" name="website">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Job Type</label>
            <select name="jobtype">
              <option value="">Select...</option>
              <option value="full-time">Full-time</option>
              <option value="part-time">Part-time</option>
            </select>
          </div>
          <div class="form-group">
            <label>Experience Level</label>
            <select name="experience">
              <option value="">Select...</option>
              <option value="internship">Internship</option>
              <option value="junior">Junior / Entry</option>
              <option value="mid">Mid Level</option>
              <option value="senior">Senior</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add Job Posting
        </button>
      </form>
    </div>

    <div class="items-list">
      <h2 style="padding:1.5rem; margin:0; border-bottom:2px solid rgba(0,0,0,.1);">Current Job Postings</h2>
      <div id="jobsList">
        <div class="empty-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Startups Tab -->
  <div id="startups" class="tab-content">
    <div class="admin-form">
      <h2>Add New Startup</h2>
      <form id="addStartupForm">
        <div class="form-row">
          <div class="form-group">
            <label>Startup Name *</label>
            <input type="text" name="name" required>
          </div>
          <div class="form-group">
            <label>Industry</label>
            <input type="text" name="industry">
          </div>
        </div>
        <div class="form-group">
          <label>Description *</label>
          <textarea name="description" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Website</label>
            <input type="url" name="website">
          </div>
          <div class="form-group">
            <label>Logo URL</label>
            <input type="url" name="logoUrl">
          </div>
        </div>
        <div class="form-group">
          <label>Detail Page URL</label>
          <input type="text" name="detailPageUrl" placeholder="e.g., Online_Startup_Companies/startup-name.html">
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add Startup
        </button>
      </form>
    </div>

    <div class="items-list">
      <h2 style="padding:1.5rem; margin:0; border-bottom:2px solid rgba(0,0,0,.1);">Current Startups</h2>
      <div id="startupsList">
        <div class="empty-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- News Tab -->
  <div id="news" class="tab-content">
    <div class="admin-form">
      <h2>Add New News</h2>
      <form id="addNewsForm">
        <div class="form-group">
          <label>Title *</label>
          <input type="text" name="title" required>
        </div>
        <div class="form-group">
          <label>Description *</label>
          <textarea name="description" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Image URL *</label>
            <input type="url" name="imageUrl" required>
          </div>
          <div class="form-group">
            <label>Date *</label>
            <input type="text" name="date" placeholder="e.g., Feb 26, 2025" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add News
        </button>
      </form>
    </div>

    <div class="items-list">
      <h2 style="padding:1.5rem; margin:0; border-bottom:2px solid rgba(0,0,0,.1);">Current News</h2>
      <div id="newsList">
        <div class="empty-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Applicants Modal -->
<div id="applicantsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalCompanyName">Applicants</h2>
      <button class="modal-close">&times;</button>
    </div>
    <div id="applicantsContent">
      <div class="empty-state">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading...</p>
      </div>
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://anka-vkrl.onrender.com';
const username = sessionStorage.getItem('username');
const isAdminValue = sessionStorage.getItem('isAdmin');
const isAdmin = isAdminValue === 'true';

// Debug logs
console.log('Admin check - username:', username);
console.log('Admin check - isAdmin from storage:', isAdminValue, 'Type:', typeof isAdminValue);
console.log('Admin check - isAdmin boolean:', isAdmin);

// Check admin status
if (!isAdmin) {
  console.error('Admin access denied. isAdmin value:', isAdminValue);
  alert('Admin access required. Redirecting to login...');
  window.location.href = 'login.html';
}

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const tabId = btn.dataset.tab;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(tabId).classList.add('active');
    
    // Reload data when switching tabs
    if (tabId === 'talent-pool') loadJobs();
    else if (tabId === 'startups') loadStartups();
    else if (tabId === 'news') loadNews();
  });
});

// Show alert
function showAlert(message, type = 'success') {
  const alertContainer = document.getElementById('alertContainer');
  const alert = document.createElement('div');
  alert.className = `alert alert-${type}`;
  alert.textContent = message;
  alertContainer.innerHTML = '';
  alertContainer.appendChild(alert);
  setTimeout(() => alert.remove(), 5000);
}

// Load Jobs
async function loadJobs() {
  try {
    const res = await fetch(`${API_BASE}/api/companies`);
    const jobs = await res.json();
    const container = document.getElementById('jobsList');
    
    if (jobs.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-briefcase"></i><p>No job postings yet</p></div>';
      return;
    }
    
    container.innerHTML = jobs.map(job => `
      <div class="item-card">
        <div class="item-info">
          <h3>${job.name}</h3>
          <p><strong>Industry:</strong> ${job.industry || 'N/A'}</p>
          <p><strong>Location:</strong> ${job.headquarters || 'N/A'}</p>
          <p><strong>Job Type:</strong> ${job.jobtype || 'N/A'} | <strong>Experience:</strong> ${job.experience || 'N/A'}</p>
          <p>${job.description_short || ''}</p>
          <p><strong>Applicants:</strong> ${(job.applicants || []).length}</p>
        </div>
        <div class="item-actions">
          <button class="btn btn-small applicants-btn" onclick="viewApplicants('${job.name}')">
            <i class="fas fa-users"></i> View Applicants
          </button>
          <button class="btn btn-small btn-danger" onclick="deleteJob('${job._id}', '${job.name}')">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('');
  } catch (err) {
    console.error('Failed to load jobs:', err);
    document.getElementById('jobsList').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load jobs</p></div>';
  }
}

// Add Job
document.getElementById('addJobForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  data.username = username;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/companies`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('Job posting added successfully!', 'success');
      e.target.reset();
      loadJobs();
    } else {
      showAlert(result.message || 'Failed to add job posting', 'error');
    }
  } catch (err) {
    showAlert('Error adding job posting', 'error');
  }
});

// Delete Job
async function deleteJob(id, name) {
  if (!confirm(`Are you sure you want to delete "${name}"?`)) return;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/companies/${id}?username=${username}`, {
      method: 'DELETE'
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('Job posting deleted successfully!', 'success');
      loadJobs();
    } else {
      showAlert(result.message || 'Failed to delete job posting', 'error');
    }
  } catch (err) {
    showAlert('Error deleting job posting', 'error');
  }
}

// View Applicants
async function viewApplicants(companyName) {
  const modal = document.getElementById('applicantsModal');
  const content = document.getElementById('applicantsContent');
  const title = document.getElementById('modalCompanyName');
  
  title.textContent = `Applicants for ${companyName}`;
  content.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Loading...</p></div>';
  modal.classList.add('active');
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/companies/${encodeURIComponent(companyName)}/applicants?username=${username}`);
    const data = await res.json();
    
    if (data.applicants.length === 0) {
      content.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>No applicants yet</p></div>';
    } else {
      content.innerHTML = `
        <ul class="applicants-list">
          ${data.applicants.map(applicant => `
            <li class="applicant-item">
              <strong>${applicant.name} ${applicant.surname}</strong>
              <p>Username: ${applicant.username}</p>
              ${applicant.cvLink ? `<p><a href="${applicant.cvLink}" target="_blank">View CV</a></p>` : ''}
            </li>
          `).join('')}
        </ul>
      `;
    }
  } catch (err) {
    content.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load applicants</p></div>';
  }
}

// Load Startups
async function loadStartups() {
  try {
    const res = await fetch(`${API_BASE}/api/startups`);
    const startups = await res.json();
    const container = document.getElementById('startupsList');
    
    if (startups.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-rocket"></i><p>No startups yet</p></div>';
      return;
    }
    
    container.innerHTML = startups.map(startup => `
      <div class="item-card">
        <div class="item-info">
          <h3>${startup.name}</h3>
          <p><strong>Industry:</strong> ${startup.industry || 'N/A'}</p>
          <p>${startup.description}</p>
          ${startup.website ? `<p><a href="${startup.website}" target="_blank">${startup.website}</a></p>` : ''}
        </div>
        <div class="item-actions">
          <button class="btn btn-small btn-danger" onclick="deleteStartup('${startup._id}', '${startup.name}')">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('');
  } catch (err) {
    console.error('Failed to load startups:', err);
    document.getElementById('startupsList').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load startups</p></div>';
  }
}

// Add Startup
document.getElementById('addStartupForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  data.username = username;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/startups`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('Startup added successfully!', 'success');
      e.target.reset();
      loadStartups();
    } else {
      showAlert(result.message || 'Failed to add startup', 'error');
    }
  } catch (err) {
    showAlert('Error adding startup', 'error');
  }
});

// Delete Startup
async function deleteStartup(id, name) {
  if (!confirm(`Are you sure you want to delete "${name}"?`)) return;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/startups/${id}?username=${username}`, {
      method: 'DELETE'
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('Startup deleted successfully!', 'success');
      loadStartups();
    } else {
      showAlert(result.message || 'Failed to delete startup', 'error');
    }
  } catch (err) {
    showAlert('Error deleting startup', 'error');
  }
}

// Load News
async function loadNews() {
  try {
    const res = await fetch(`${API_BASE}/api/news`);
    const news = await res.json();
    const container = document.getElementById('newsList');
    
    if (news.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-newspaper"></i><p>No news yet</p></div>';
      return;
    }
    
    container.innerHTML = news.map(item => `
      <div class="item-card">
        <div class="item-info">
          <h3>${item.title}</h3>
          <p><strong>Date:</strong> ${item.date}</p>
          <p>${item.description.substring(0, 150)}${item.description.length > 150 ? '...' : ''}</p>
          ${item.imageUrl ? `<p><a href="${item.imageUrl}" target="_blank">View Image</a></p>` : ''}
        </div>
        <div class="item-actions">
          <button class="btn btn-small btn-danger" onclick="deleteNews('${item._id}', '${item.title}')">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('');
  } catch (err) {
    console.error('Failed to load news:', err);
    document.getElementById('newsList').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Failed to load news</p></div>';
  }
}

// Add News
document.getElementById('addNewsForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  data.username = username;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/news`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('News added successfully!', 'success');
      e.target.reset();
      loadNews();
    } else {
      showAlert(result.message || 'Failed to add news', 'error');
    }
  } catch (err) {
    showAlert('Error adding news', 'error');
  }
});

// Delete News
async function deleteNews(id, title) {
  if (!confirm(`Are you sure you want to delete "${title}"?`)) return;
  
  try {
    const res = await fetch(`${API_BASE}/api/admin/news/${id}?username=${username}`, {
      method: 'DELETE'
    });
    
    const result = await res.json();
    if (res.ok) {
      showAlert('News deleted successfully!', 'success');
      loadNews();
    } else {
      showAlert(result.message || 'Failed to delete news', 'error');
    }
  } catch (err) {
    showAlert('Error deleting news', 'error');
  }
}

// Modal close
document.querySelector('.modal-close').addEventListener('click', () => {
  document.getElementById('applicantsModal').classList.remove('active');
});

document.getElementById('applicantsModal').addEventListener('click', (e) => {
  if (e.target.id === 'applicantsModal') {
    document.getElementById('applicantsModal').classList.remove('active');
  }
});

// Initial load
loadJobs();
</script>
</body>
</html>

