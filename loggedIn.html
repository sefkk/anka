<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="https://fonts.googleapis.com/css?family=Lovers+Quarrel" rel="stylesheet">
<link href="https://fonts.cdnfonts.com/css/handwriting" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Berkshire Swash' rel='stylesheet'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css"/> 
<title>Anka Member Page</title>

<style>
/* ------- Design Tokens ------- */
:root{
  --bg:#ffffff; --text:#222; --muted:#6b6b6b;
  --brand-1:#f0b26f; --brand-2:#e2874a; --ring:#ffcf9b;
  --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.08);
  --gradient-1: linear-gradient(135deg, #f0b26f 0%, #e2874a 100%);
  --gradient-2: linear-gradient(135deg, #ffd89b 0%, #f0b26f 100%);
}

/* ------- Base ------- */
*{
    box-sizing:border-box;
    scroll-behavior: smooth;
}

html,body{height:100%}
body{
  margin:0; padding:0; font-family:'Poppins',system-ui,Arial,sans-serif; color:var(--text);
  background: linear-gradient(180deg, #fafafa 0%, #ffffff 100%);
  transition: all 0.3s ease;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(240, 178, 111, 0.03) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(226, 135, 74, 0.03) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

body > * {
  position: relative;
  z-index: 1;
}

/* Global smooth transitions (ani. kapatma desteği ile) */
a, button, .linktree-buttons a, #navbar, .site-footer{
  transition: background-color .25s ease, color .25s ease, border-color .25s ease,
              transform .25s ease, box-shadow .25s ease, opacity .25s ease, background-position .5s ease;
}
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* ------- Top Bar (Fixed, translucent, blurred) ------- */
.site-topbar{
  inset:0 0 auto 0; z-index:100;
  backdrop-filter:saturate(140%) blur(8px);
  -webkit-backdrop-filter:saturate(140%) blur(8px);
  background: color-mix(in srgb, #ffffff 70%, transparent);
  border-bottom:1px solid rgba(0,0,0,.06);
  box-shadow: 0 6px 24px rgba(0,0,0,.06);
  transform: translateY(-100%);
  animation: topbarIn .6s cubic-bezier(.2,.7,.2,1) .1s forwards;
}
@media (prefers-color-scheme: dark){
  .site-topbar{
    background: color-mix(in srgb, #121214 72%, transparent);
    border-bottom-color: rgba(255,255,255,.06);
  }
}
@keyframes topbarIn{to{transform: translateY(0)}}

.container{width:min(100% - 2rem, 1100px); margin-inline:auto}

/* ------- Welcome ------- */
.welcome-section{ 
  padding: calc(64px + 4rem) 0 3rem; 
  text-align:center;
  background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(250, 240, 230, 0.3) 100%);
  border-radius: 0 0 32px 32px;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
}

.welcome-section::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(240, 178, 111, 0.08) 0%, transparent 70%);
  animation: pulse 8s ease-in-out infinite;
  pointer-events: none;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 0.5; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

#welcomeMessage{
  margin:0 0 1rem; 
  font-weight:700; 
  font-size:clamp(1.8rem,4vw,2.6rem);
  background: linear-gradient(135deg, var(--brand-1), var(--brand-2), #d67a3f);
  -webkit-background-clip:text; 
  background-clip:text; 
  color:transparent;
  position: relative;
  display: inline-block;
  animation: fadeInUp 0.6s ease-out;
}

#welcomeMessage::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 3px;
  background: var(--gradient-1);
  border-radius: 2px;
  opacity: 0.6;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.welcome-sub{ 
  margin:0 0 2rem; 
  color:var(--muted);
  font-size: 1.05rem;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.6;
}

/* ------- Services (Linktree) ------- */
.services-section{
  text-align:center; 
  margin: 4rem 0 5rem;
  padding: 3rem 0;
  position: relative;
}
.services-section h2{
  font-weight:700; 
  font-size:clamp(1.6rem,3.2vw,2.2rem);
  margin:0 0 2.5rem;
  background: linear-gradient(135deg, #e5925a, #ffb97a);
  -webkit-background-clip:text; 
  background-clip:text; 
  color:transparent;
  position: relative;
  display: inline-block;
}

.services-section h2::after {
  content: '';
  position: absolute;
  bottom: -12px;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 3px;
  background: var(--gradient-1);
  border-radius: 2px;
}

.linktree-buttons{
  display:grid; 
  grid-template-columns:1fr; 
  gap:1.2rem; 
  width:min(100% - 2rem, 760px); 
  margin-inline:auto;
}
@media (min-width:700px){ 
  .linktree-buttons{ 
    grid-template-columns:1fr 1fr;
    gap: 1.5rem;
  } 
}
.linktree-buttons a{
  display:flex; 
  align-items:center; 
  justify-content:center; 
  gap:.8rem;
  min-height:64px; 
  padding:1.2rem 1.5rem; 
  border-radius:var(--radius);
  text-decoration:none; 
  font-size:1.05rem; 
  font-weight:600; 
  color:#fff;
  background-image: var(--gradient-1);
  background-size:200% 200%; 
  background-position:100% 100%;
  box-shadow: 0 8px 24px rgba(226,135,74,.2), 0 2px 8px rgba(0,0,0,.1);
  border:1px solid rgba(255,255,255,.2);
  position: relative;
  overflow: hidden;
}

.linktree-buttons a::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
  transition: left 0.5s ease;
}

.linktree-buttons a:hover::before {
  left: 100%;
}

.linktree-buttons a:hover{
  transform: translateY(-4px) scale(1.02);
  background-position:0 0;
  box-shadow: 0 16px 40px rgba(226,135,74,.35), 0 4px 12px rgba(0,0,0,.15);
  color:#fff;
}

.linktree-buttons a:active {
  transform: translateY(-2px) scale(1);
}

.linktree-buttons a:focus-visible{ 
  outline:none; 
  box-shadow:0 0 0 4px var(--ring), 0 8px 24px rgba(226,135,74,.2);
}

.linktree-buttons a i {
  font-size: 1.3rem;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,.1));
}

/* ------- Footer (daha temiz) ------- */
footer.site-footer{
  margin-top: 4rem;
  padding-left: 3rem;
  background: linear-gradient(180deg, rgba(0,0,0,.03), transparent);
  border-top:1px solid rgba(0,0,0,.08);
  color:var(--muted);
}
@media (prefers-color-scheme: dark){
  footer.site-footer{ border-top-color: rgba(255,255,255,.1) }
}
.footer-inner{
  display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between;
  gap:.75rem; padding:4.25rem 2rem 2rem;
}
.footer-left, .footer-right{font-size:.95rem}
.footer-right a{ color:inherit; text-decoration:none; border-bottom:1px dashed transparent }
.footer-right a:hover{ border-bottom-color: currentColor }

/* ------- Utility ------- */
.mt-hero-offset{ margin-top:64px } /* JS’siz sabit bar telafisi */

/* ---- Likert (1–5) ---- */
.mood-question {
  margin: 2rem 0 1rem;
  font-weight: 600;
  color: var(--muted);
  font-size: 1.1rem;
  display: inline-block;
  padding: 0.5rem 1.5rem;
  background: rgba(240, 178, 111, 0.1);
  border-radius: 20px;
  border: 1px solid rgba(240, 178, 111, 0.2);
}

.mood-wrap{ 
  margin-top:1.5rem; 
  display:grid; 
  place-items:center;
  padding: 1.5rem 0;
}
.mood-scale{
  display:flex; 
  gap:0.5rem; 
  padding:.8rem 1rem; 
  border-radius:16px;
  background: rgba(255,255,255,0.8);
  backdrop-filter: blur(10px);
  border:2px solid rgba(240, 178, 111, 0.2);
  box-shadow: 0 4px 16px rgba(0,0,0,.08);
  position:relative; 
  will-change:opacity,transform;
}
@media (prefers-color-scheme: dark){
  .mood-scale{ background:rgba(255,255,255,.04); border-color:rgba(255,255,255,.12) }
}
.mood-scale legend{ 
  position:absolute; 
  width:1px; 
  height:1px; 
  clip:rect(0 0 0 0); 
  clip-path:inset(50%); 
  overflow:hidden; 
  white-space:nowrap 
}
.mood-option{ display:contents }
.mood-option input[type="checkbox"]{
  position:absolute; 
  opacity:0; 
  inset:auto; 
  pointer-events:auto; 
  margin:0;
}
.mood-option label{
  width:52px; 
  height:52px; 
  display:grid; 
  place-items:center;
  margin:0; 
  font-weight:700; 
  font-size:1.1rem; 
  line-height:1;
  border:2.5px solid currentColor; 
  border-radius:12px;
  background:transparent; 
  color:#999; 
  cursor:pointer;
  transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
  user-select:none;
  position: relative;
}

.mood-option label::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: 14px;
  background: currentColor;
  opacity: 0;
  transform: scale(0.8);
  transition: all .3s ease;
  z-index: -1;
}

.mood-option input[data-score="1"] + label{ color:#e74c3c }
.mood-option input[data-score="2"] + label{ color:#f39c12 }
.mood-option input[data-score="3"] + label{ color:#f1c40f }
.mood-option input[data-score="4"] + label{ color:#2ecc71 }
.mood-option input[data-score="5"] + label{ color:#137a3a }

.mood-option input:focus-visible + label{ 
  box-shadow:0 0 0 4px var(--ring,#ffcf9b);
  outline: none;
}

.mood-option input:hover + label {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
}

.mood-option input:active + label{ 
  transform:scale(.95); 
}

.mood-option input:checked + label{ 
  background: currentColor; 
  color:#fff; 
  transform:scale(1.05);
  box-shadow: 0 4px 16px rgba(0,0,0,.2);
  border-color: currentColor;
}

.mood-option input:checked + label::before {
  opacity: 0.2;
  transform: scale(1.3);
}

@keyframes moodFadeOut{ 
  to{ 
    opacity:0; 
    transform:scale(.95) translateY(-10px);
  } 
}
.mood-wrap:has(input:checked) .mood-scale{
  animation: moodFadeOut .4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}
.mood-thanks{
  opacity:0; 
  transform: translateY(10px);
  transition: opacity .4s ease .3s, transform .4s cubic-bezier(0.4, 0, 0.2, 1) .3s;
  font-weight:600; 
  text-align:center; 
  color:var(--muted);
  font-size: 1.05rem;
  padding: 0.75rem 1.5rem;
  background: rgba(240, 178, 111, 0.1);
  border-radius: 20px;
  border: 1px solid rgba(240, 178, 111, 0.2);
  display: inline-block;
}
.mood-wrap:has(input:checked) .mood-thanks{
  opacity:1; 
  transform:translateY(0);
}
.mood-scale, .mood-option label{ letter-spacing:0; }

/* News Section Enhancement */
.news-cards-section {
  background: linear-gradient(180deg, #f9f9f9 0%, #ffffff 100%);
  border-radius: 32px 32px 0 0;
  margin-top: 2rem;
}

.news-cards-section h2 {
  position: relative;
  padding-bottom: 1rem;
}

.news-cards-section h2::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 3px;
  background: var(--gradient-1);
  border-radius: 2px;
}
</style>
</head>
<body>

<!-- Fixed, translucent navbar wrapper -->
<header>
  <div id="navbar"></div>

  <!-- Welcome -->
  <section class="welcome-section">
    <div class="container">
      <h1 id="welcomeMessage"></h1>
      <p class="welcome-sub" data-i18n="loggedin.subtitle">Here you can find your MyANKA page. You can access services, applications, and special discounts only for ANKA members.</p>
    </div>

    <div>
      <span class="mood-question" data-i18n="loggedin.mood.question">How are you feeling today?</span>
    </div>

    <div class="mood-wrap" aria-label="How are you feeling today questionnaire">
      <fieldset class="mood-scale">
        <legend data-i18n="loggedin.mood.question">How are you feeling today?</legend>
        <div class="mood-option"><input id="mood-1" type="checkbox" data-score="1"><label for="mood-1">1</label></div>
        <div class="mood-option"><input id="mood-2" type="checkbox" data-score="2"><label for="mood-2">2</label></div>
        <div class="mood-option"><input id="mood-3" type="checkbox" data-score="3"><label for="mood-3">3</label></div>
        <div class="mood-option"><input id="mood-4" type="checkbox" data-score="4"><label for="mood-4">4</label></div>
        <div class="mood-option"><input id="mood-5" type="checkbox" data-score="5"><label for="mood-5">5</label></div>
      </fieldset>
      <div class="mood-thanks" aria-live="polite" data-i18n="loggedin.mood.thanks">Thank you for your response.</div>
    </div>
  </section>
</header>

<!-- ANKA News Section -->
<section class="news-cards-section" style="padding: 60px 20px;">
  <div class="container">
    <h2 style="text-align: center; font-size: clamp(1.6rem,3.2vw,2.2rem); margin-bottom: 2rem; background: linear-gradient(45deg, #e5925a, #ffb97a); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 700;" data-i18n="loggedin.news.title">ANKA News</h2>
    <div class="news-cards-container" id="newsCardsContainer">
      <!-- News cards will be loaded dynamically -->
    </div>
  </div>
</section>

<!-- News Modal -->
<div id="newsModal" class="news-modal">
  <div class="news-modal-content">
    <button class="news-modal-close">&times;</button>
    <div class="news-modal-image">
      <img id="modalImage" src="" alt="News Image">
    </div>
    <div class="news-modal-info">
      <h2 id="modalTitle"></h2>
      <div class="news-modal-date" id="modalDate"></div>
      <p id="modalDescription"></p>
    </div>
  </div>
</div>

<!-- Services -->
<section class="services-section">
  <div class="container">
    <h2 data-i18n="loggedin.services.title">Our Services</h2>
    <div class="linktree-buttons" role="list">
      <a role="listitem" href="../myrights.html"><i class="fas fa-balance-scale"></i> <span data-i18n="loggedin.services.legal">Legal Consultancy</span></a>
      <a role="listitem" href="Talent-Pool/talent-pool.html"><i class="fas fa-user-friends"></i> <span data-i18n="loggedin.services.talent">ANKA Talent Pool</span></a>
      <a role="listitem" href="komite-basvuru-form.html"><i class="fas fa-clipboard-check"></i> <span data-i18n="loggedin.services.committee">ANKA Committee Position Application</span></a>
      <a role="listitem" href="special.html"><i class="fas fa-tags"></i> <span data-i18n="loggedin.services.discounts">ANKA Special Discounts and Campaigns</span></a>
    </div>
  </div>
</section>


<div id="footer"></div>

<script src="i18n.js"></script>
<!-- ✅ Fixed JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const t = (key, fallback) =>
    (window.getI18nString ? window.getI18nString(key) : '') || fallback;

  // Load navbar and footer
  fetch('Partials/inner-navbar.html')
    .then(r => r.text())
    .then(html => {
      document.getElementById('navbar').innerHTML = html;
      if (window.initI18n) {
        window.initI18n();
      }
    });

  fetch('Partials/footer-loggedin.html')
    .then(res => res.text())
    .then(data => {
      document.getElementById('footer').innerHTML = data;
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();
    })
    .catch(() => {
      // Fallback to regular footer if logged-in footer doesn't exist
      fetch('Partials/footer.html')
        .then(res => res.text())
        .then(data => {
          document.getElementById('footer').innerHTML = data;
          const yearEl = document.getElementById('year');
          if (yearEl) yearEl.textContent = new Date().getFullYear();
        });
    });

  // Function to update welcome message dynamically
  function updateWelcomeMessage() {
    const welcomeElement = document.getElementById('welcomeMessage');
    if (!welcomeElement) return;
    
    const userName = sessionStorage.getItem('name');
    const welcomeTemplate = t('loggedin.welcome', 'Welcome {name}!');
    const welcomeFallback = t('loggedin.welcome_member', 'Welcome member!');
    welcomeElement.textContent = userName
      ? welcomeTemplate.replace('{name}', userName)
      : welcomeFallback;
  }

  // Login check and welcome message
  const isLoggedIn = sessionStorage.getItem('isLoggedIn');
  if (isLoggedIn !== 'true') {
    window.location.href = 'login.html';
  } else {
    // Initial welcome message
    updateWelcomeMessage();
    
    // Listen for language changes by monitoring language button clicks
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('lang-btn')) {
        // Wait a bit for i18n to update, then update welcome message
        setTimeout(updateWelcomeMessage, 100);
      }
    });
    
    // Also listen for storage events (works across tabs)
    window.addEventListener('storage', (e) => {
      if (e.key === 'anka_lang') {
        updateWelcomeMessage();
      }
    });
    
    // Monitor localStorage changes (for same-tab language changes)
    let lastLang = localStorage.getItem('anka_lang') || 'en';
    setInterval(() => {
      const currentLang = localStorage.getItem('anka_lang') || 'en';
      if (currentLang !== lastLang) {
        lastLang = currentLang;
        updateWelcomeMessage();
      }
    }, 200);
  }

  // Load News from API
  async function loadNews() {
    const container = document.getElementById('newsCardsContainer');
    const API_URL = 'https://anka-vkrl.onrender.com/api/news';
    
    try {
      console.log('Fetching news from:', API_URL);
      const response = await fetch(API_URL);
      
      console.log('Response status:', response.status, response.statusText);
      
      if (!response.ok) {
        // If 404, backend might not be deployed or endpoint doesn't exist
        if (response.status === 404) {
          console.warn('News endpoint not found (404). Backend might need deployment.');
          container.innerHTML = `<p style="text-align:center; color:var(--muted); padding:2rem;">${t('loggedin.news.setup', 'News feature is being set up. Please check back later.')}</p>`;
          return;
        }
        console.error('Failed to fetch news:', response.status, response.statusText);
        container.innerHTML = `<p style="text-align:center; color:var(--muted);">${t('loggedin.news.error', 'Failed to load news. Please try again later.')}</p>`;
        return;
      }
      
      const news = await response.json();
      console.log('Received news data:', news);
      
      if (!Array.isArray(news)) {
        console.error('News is not an array:', news);
        container.innerHTML = `<p style="text-align:center; color:var(--muted);">${t('loggedin.news.empty', 'No news available.')}</p>`;
        return;
      }
      
      if (news.length === 0) {
        container.innerHTML = `<p style="text-align:center; color:var(--muted);">${t('loggedin.news.empty', 'No news available.')}</p>`;
        return;
      }
      
      container.innerHTML = news.map(item => `
        <div class="news-card" data-title="${(item.title || '').replace(/"/g, '&quot;')}" data-description="${(item.description || '').replace(/"/g, '&quot;')}">
          <div class="news-card-image">
            <img src="${item.imageUrl || ''}" alt="${item.title || 'News'}">
          </div>
          <div class="news-card-date">${item.date || ''}</div>
        </div>
      `).join('');
      
      // Re-attach event listeners after loading news
      attachNewsModalListeners();
    } catch (err) {
      console.error('Failed to load news:', err);
      container.innerHTML = `<p style="text-align:center; color:var(--muted);">${t('loggedin.news.error', 'Failed to load news. Please try again later.')}</p>`;
    }
  }

  // News Modal Functionality
  function attachNewsModalListeners() {
    const newsCards = document.querySelectorAll('.news-card');
    const modal = document.getElementById('newsModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalDate = document.getElementById('modalDate');
    const modalDescription = document.getElementById('modalDescription');
    const closeBtn = document.querySelector('.news-modal-close');

    if (newsCards.length > 0 && modal) {
      newsCards.forEach(card => {
        card.addEventListener('click', () => {
          const img = card.querySelector('img');
          const date = card.querySelector('.news-card-date').textContent;
          const title = card.getAttribute('data-title');
          const description = card.getAttribute('data-description');

          modalImage.src = img.src;
          modalImage.alt = img.alt;
          modalTitle.textContent = title;
          modalDate.textContent = date;
          modalDescription.textContent = description;

          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        });
      });

      closeBtn.addEventListener('click', () => {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      });

      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        }
      });

      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    }
  }

  // Load news on page load
  loadNews();
});
</script>
</body>
</html>